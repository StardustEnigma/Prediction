{% extends 'base.html' %}
{% load static %}
{% block title %}Analytics - AttritionAI{% endblock %}
{% block content %}

<!-- Analytics Hero Section with Matching Dashboard Theme -->
<div class="relative overflow-hidden bg-gradient-to-br from-purple-50 via-lavender-50 to-pink-50 py-16">
    <!-- Animated Background Elements -->
    <div class="absolute inset-0 overflow-hidden">
        <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob"></div>
        <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute top-40 left-1/2 w-80 h-80 bg-lavender-300 rounded-full mix-blend-multiply filter blur-xl opacity-30 animate-blob animation-delay-4000"></div>
    </div>
    
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header with Typing Animation -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center px-4 py-2 mb-6 text-sm font-semibold text-purple-700 bg-purple-100 rounded-full animate-pulse">
                <span class="mr-2">üìä</span> Advanced Analytics Dashboard
            </div>
            
            <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 animate-fade-in">
                Employee <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-pink-600 to-indigo-600 animate-gradient">Analytics</span>
            </h1>
            <p class="text-xl text-gray-700 font-medium max-w-3xl mx-auto leading-relaxed animate-slide-up">
                Harness the power of AI to predict and prevent employee attrition with real-time insights
            </p>
        </div>

        <!-- Enhanced Stats Cards with Glassmorphism - Dashboard Style -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <!-- Total Employees -->
            <div class="group relative glass-card p-6 rounded-2xl transform hover:scale-105 transition-all duration-500 hover:shadow-2xl animate-fade-in-up" style="animation-delay: 0.1s;">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-400 to-purple-400 rounded-2xl opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <div class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2 counter" data-target="{{ total_employees }}">0</div>
                    <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider">Total Employees</div>
                    <div class="mt-3 flex items-center justify-center text-xs text-gray-500">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            <span class="mr-1">üìä</span> Active Workforce
                        </span>
                    </div>
                </div>
            </div>

            <!-- Retained Employees -->
            <div class="group relative glass-card p-6 rounded-2xl transform hover:scale-105 transition-all duration-500 hover:shadow-2xl animate-fade-in-up" style="animation-delay: 0.2s;">
                <div class="absolute inset-0 bg-gradient-to-r from-green-400 to-emerald-400 rounded-2xl opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="text-4xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent mb-2 counter" data-target="{{ retained_employees }}">0</div>
                    <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider">Retained</div>
                    <div class="mt-3 flex items-center justify-center text-xs text-gray-500">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            <span class="mr-1">‚úÖ</span> {{ retention_rate }}% Rate
                        </span>
                    </div>
                </div>
            </div>

            <!-- High Risk Employees -->
            <div class="group relative glass-card p-6 rounded-2xl transform hover:scale-105 transition-all duration-500 hover:shadow-2xl animate-fade-in-up" style="animation-delay: 0.3s;">
                <div class="absolute inset-0 bg-gradient-to-r from-red-400 to-pink-400 rounded-2xl opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-red-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                    </div>
                    <div class="text-4xl font-bold bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent mb-2 counter" data-target="{{ high_risk }}">0</div>
                    <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider">High Risk</div>
                    <div class="mt-3 flex items-center justify-center text-xs text-gray-500">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                            <span class="mr-1">‚ö†Ô∏è</span> ‚â•75% Risk
                        </span>
                    </div>
                </div>
            </div>

            <!-- At Risk Total -->
            <div class="group relative glass-card p-6 rounded-2xl transform hover:scale-105 transition-all duration-500 hover:shadow-2xl animate-fade-in-up" style="animation-delay: 0.4s;">
                <div class="absolute inset-0 bg-gradient-to-r from-orange-400 to-amber-400 rounded-2xl opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-orange-500 to-amber-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:rotate-12 transition-transform duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div class="text-4xl font-bold bg-gradient-to-r from-orange-600 to-amber-600 bg-clip-text text-transparent mb-2 counter" data-target="{{ attrition_employees }}">0</div>
                    <div class="text-sm font-semibold text-gray-600 uppercase tracking-wider">At-Risk</div>
                    <div class="mt-3 flex items-center justify-center text-xs text-gray-500">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800">
                            <span class="mr-1">üìà</span> {{ avg_risk_score }}% Avg
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Section with Modern Design -->
<div class="py-20 bg-gradient-to-b from-white to-gray-50" id="charts-section">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Overview Charts Section -->
        <div class="glass-card-white p-10 rounded-3xl mb-12 shadow-2xl animate-fade-in-up">
            <div class="text-center mb-10">
                <div class="inline-flex items-center justify-center px-4 py-2 mb-6 text-sm font-semibold text-indigo-700 bg-indigo-100 rounded-full">
                    <span class="mr-2">üìä</span> Workforce Analytics
                </div>
                <h2 class="text-4xl font-bold text-gray-900 mb-4">
                    Employee <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Insights</span>
                </h2>
                <p class="text-gray-600 font-medium max-w-3xl mx-auto text-lg">
                    Comprehensive analysis of workforce patterns and attrition factors
                </p>
            </div>
            
            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12">
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Risk Distribution</h3>
                    <div style="height: 280px;">
                        <canvas id="riskDistributionChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Gender Analysis</h3>
                    <div style="height: 280px;">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4 text-center">Satisfaction Levels</h3>
                    <div style="height: 280px;">
                        <canvas id="satisfactionChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Demographic Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Age Group Analysis</h3>
                    <div style="height: 320px;">
                        <canvas id="ageGroupChart"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Experience Analysis</h3>
                    <div style="height: 320px;">
                        <canvas id="experienceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Distribution Analysis -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Salary Distribution</h3>
                    <div style="height: 320px;">
                        <canvas id="salaryHistogram"></canvas>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl p-6 shadow-lg border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Risk Score Distribution</h3>
                    <div style="height: 320px;">
                        <canvas id="riskHistogram"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Importance Section -->
        <div class="glass-card-white p-10 rounded-3xl mb-12 shadow-2xl animate-fade-in-up">
            <div class="text-center mb-10">
                <div class="inline-flex items-center justify-center px-4 py-2 mb-6 text-sm font-semibold text-purple-700 bg-purple-100 rounded-full">
                    <span class="mr-2">ü§ñ</span> ML-Powered Insights
                </div>
                <h2 class="text-4xl font-bold text-gray-900 mb-4">
                    Feature <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">Importance</span>
                </h2>
                <p class="text-gray-600 font-medium max-w-3xl mx-auto text-lg">
                    AI-driven insights into the key factors influencing employee retention
                </p>
            </div>
            
            <div class="bg-white rounded-2xl p-6 shadow-inner">
                <div style="position: relative; height: 400px; width: 100%;">
                    <canvas id="featureImportanceChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Quick Actions with Modern Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Upload CSV Action -->
            <div class="group relative overflow-hidden glass-card-white p-8 rounded-2xl text-center shadow-xl hover:shadow-2xl transition-all duration-500 animate-fade-in-up" style="animation-delay: 0.6s;">
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full opacity-10 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:scale-110 group-hover:rotate-3 transition-all duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Upload CSV</h3>
                    <p class="text-gray-600 mb-6">Analyze employee data in bulk with AI</p>
                    <a href="{% url 'employee:upload_csv' %}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-xl hover:from-blue-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                        <span class="mr-2">üìä</span> Analyze Data
                    </a>
                </div>
            </div>

            <!-- View Reports Action -->
            <div class="group relative overflow-hidden glass-card-white p-8 rounded-2xl text-center shadow-xl hover:shadow-2xl transition-all duration-500 animate-fade-in-up" style="animation-delay: 0.7s;">
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-gradient-to-br from-indigo-400 to-pink-400 rounded-full opacity-10 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-6 bg-gradient-to-br from-indigo-500 to-pink-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:scale-110 group-hover:rotate-3 transition-all duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">View Reports</h3>
                    <p class="text-gray-600 mb-6">Detailed analytics and insights</p>
                    <a href="{% url 'employee:reports' %}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-500 to-pink-600 text-white font-semibold rounded-xl hover:from-indigo-600 hover:to-pink-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                        <span class="mr-2">üìã</span> View Reports
                    </a>
                </div>
            </div>

            <!-- Feedback Form Action -->
            <div class="group relative overflow-hidden glass-card-white p-8 rounded-2xl text-center shadow-xl hover:shadow-2xl transition-all duration-500 animate-fade-in-up" style="animation-delay: 0.8s;">
                <div class="absolute top-0 right-0 -mt-4 -mr-4 w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-400 rounded-full opacity-10 group-hover:scale-150 transition-transform duration-500"></div>
                <div class="relative">
                    <div class="w-16 h-16 mx-auto mb-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-2xl flex items-center justify-center shadow-lg transform group-hover:scale-110 group-hover:rotate-3 transition-all duration-300">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13.5 7a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-3">Risk Assessment</h3>
                    <p class="text-gray-600 mb-6">Individual employee evaluation</p>
                    <a href="{% url 'employee:feedback' %}" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-semibold rounded-xl hover:from-green-600 hover:to-emerald-700 transform hover:scale-105 transition-all duration-300 shadow-lg">
                        <span class="mr-2">üìù</span> Get Assessment
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Floating Scroll to Charts Button -->
<button 
    onclick="scrollToCharts()" 
    class="scroll-to-charts-btn"
    title="View Charts">
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
    </svg>
    View Charts
</button>

<!-- Enhanced CSS with Modern Animations -->
<style>
    /* Smooth scroll behavior */
    html {
        scroll-behavior: smooth;
    }

    /* Floating Scroll to Charts Button */
    .scroll-to-charts-btn {
        position: fixed;
        right: 1.5rem;
        bottom: 2rem;
        background: linear-gradient(135deg, #8B5CF6, #EC4899);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 0.75rem 1.25rem;
        font-weight: 600;
        font-size: 0.875rem;
        cursor: pointer;
        box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        display: flex;
        align-items: center;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transform: translateY(0);
        animation: float 3s ease-in-out infinite;
    }

    .scroll-to-charts-btn:hover {
        background: linear-gradient(135deg, #7C3AED, #DB2777);
        box-shadow: 0 12px 35px rgba(139, 92, 246, 0.4);
        transform: translateY(-3px) scale(1.05);
    }

    .scroll-to-charts-btn:active {
        transform: translateY(-1px) scale(0.98);
    }

    /* Floating animation */
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
    }

    /* Hide button on mobile to avoid interference */
    @media (max-width: 768px) {
        .scroll-to-charts-btn {
            display: none;
        }
    }

    /* Glassmorphism Effects */
    .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }
    
    .glass-card-white {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    /* Animations */
    @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
    
    @keyframes gradient {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slide-up {
        from { 
            opacity: 0;
            transform: translateY(30px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fade-in-up {
        from {
            opacity: 0;
            transform: translateY(40px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Animation Classes */
    .animate-blob {
        animation: blob 7s infinite;
    }
    
    .animation-delay-2000 {
        animation-delay: 2s;
    }
    
    .animation-delay-4000 {
        animation-delay: 4s;
    }
    
    .animate-gradient {
        background-size: 200% 200%;
        animation: gradient 5s ease infinite;
    }
    
    .animate-fade-in {
        animation: fade-in 1s ease-out;
    }
    
    .animate-slide-up {
        animation: slide-up 1s ease-out;
    }
    
    .animate-fade-in-up {
        opacity: 0;
        animation: fade-in-up 0.8s ease-out forwards;
    }
    
    /* Counter Animation */
    .counter {
        display: inline-block;
        min-width: 3ch;
    }
    
    /* Hover Effects */
    .group:hover .group-hover\:rotate-12 {
        transform: rotate(12deg);
    }
    
    .group:hover .group-hover\:scale-110 {
        transform: scale(1.1);
    }
    
    .group:hover .group-hover\:rotate-3 {
        transform: rotate(3deg) scale(1.1);
    }
    
    .group:hover .group-hover\:scale-150 {
        transform: scale(1.5);
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
        .glass-card {
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        
        .animate-blob {
            display: none;
        }
    }
</style>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<!-- Analytics JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Parse backend data
    const riskDistribution = {{ risk_distribution|safe }};
    const genderData = {{ gender_data|safe }};
    const satisfactionData = {{ satisfaction_data|safe }};
    const ageGroupData = {{ age_group_data|safe }};
    const experienceData = {{ experience_data|safe }};
    const salaryDistribution = {{ salary_distribution|safe }};
    const riskScoreDistribution = {{ risk_score_distribution|safe }};
    const featureImportance = {{ feature_importance|safe }};

    // AttritionAI Color Palette
    const colors = {
        primary: ['#8B5CF6', '#A855F7', '#9333EA', '#7E22CE', '#6B21A8', '#581C87'],
        success: ['#10B981', '#059669', '#047857'],
        warning: ['#F59E0B', '#D97706', '#B45309'],
        danger: ['#EF4444', '#DC2626', '#B91C1C'],
        info: ['#3B82F6', '#2563EB', '#1D4ED8'],
        gradients: {
            primary: 'rgba(139, 92, 246, 0.8)',
            success: 'rgba(16, 185, 129, 0.8)',
            warning: 'rgba(245, 158, 11, 0.8)',
            danger: 'rgba(239, 68, 68, 0.8)',
            info: 'rgba(59, 130, 246, 0.8)'
        }
    };

    // Chart defaults
    Chart.defaults.font.family = 'Inter';
    Chart.defaults.font.size = 12;
    Chart.defaults.color = '#6B7280';

    // 1. Risk Distribution Doughnut Chart
    new Chart(document.getElementById('riskDistributionChart'), {
        type: 'doughnut',
        data: {
            labels: riskDistribution.labels,
            datasets: [{
                data: riskDistribution.data,
                backgroundColor: [colors.gradients.success, colors.gradients.warning, colors.gradients.danger],
                borderColor: [colors.success[0], colors.warning[0], colors.danger[0]],
                borderWidth: 2,
                hoverOffset: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { padding: 15, usePointStyle: true, font: { size: 11 } }
                }
            }
        }
    });

    // 2. Gender Analysis Pie Chart
    let processedGenderData = { labels: [], data: [] };
    const genderMap = new Map();
    
    if (genderData.labels && genderData.data) {
        for (let i = 0; i < genderData.labels.length; i++) {
            const label = String(genderData.labels[i]).toLowerCase();
            const value = genderData.data[i] || 0;
            
            let normalizedLabel = 'Other';
            if (label === 'male' || label === 'm') normalizedLabel = 'Male';
            else if (label === 'female' || label === 'f') normalizedLabel = 'Female';
            
            genderMap.set(normalizedLabel, (genderMap.get(normalizedLabel) || 0) + value);
        }
    }
    
    processedGenderData.labels = Array.from(genderMap.keys());
    processedGenderData.data = Array.from(genderMap.values());
    
    if (processedGenderData.labels.length === 0) {
        processedGenderData = { labels: ['No Data'], data: [1] };
    }

    new Chart(document.getElementById('genderChart'), {
        type: 'pie',
        data: {
            labels: processedGenderData.labels,
            datasets: [{
                data: processedGenderData.data,
                backgroundColor: [colors.gradients.primary, colors.gradients.danger, colors.gradients.info],
                borderColor: [colors.primary[0], colors.danger[0], colors.info[0]],
                borderWidth: 2,
                hoverOffset: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { padding: 15, usePointStyle: true, font: { size: 11 } }
                }
            }
        }
    });

    // 3. Satisfaction Polar Area Chart
    new Chart(document.getElementById('satisfactionChart'), {
        type: 'polarArea',
        data: {
            labels: satisfactionData.labels,
            datasets: [{
                data: satisfactionData.data,
                backgroundColor: [
                    'rgba(16, 185, 129, 0.7)',
                    'rgba(59, 130, 246, 0.7)',
                    'rgba(245, 158, 11, 0.7)',
                    'rgba(239, 68, 68, 0.7)',
                    'rgba(107, 114, 128, 0.7)'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { padding: 10, usePointStyle: true, font: { size: 10 } }
                }
            }
        }
    });

    // 4. Age Group Horizontal Bar Chart
    new Chart(document.getElementById('ageGroupChart'), {
        type: 'bar',
        data: {
            labels: ageGroupData.labels,
            datasets: [{
                data: ageGroupData.data,
                backgroundColor: colors.gradients.primary,
                borderColor: colors.primary[0],
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                x: { beginAtZero: true, title: { display: true, text: 'Count' } }
            }
        }
    });

    // 5. Experience Chart
    new Chart(document.getElementById('experienceChart'), {
        type: 'bar',
        data: {
            labels: experienceData.labels,
            datasets: [{
                data: experienceData.data,
                backgroundColor: colors.gradients.warning,
                borderColor: colors.warning[0],
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Count' } }
            }
        }
    });

    // 6. Salary Histogram
    new Chart(document.getElementById('salaryHistogram'), {
        type: 'bar',
        data: {
            labels: salaryDistribution.labels,
            datasets: [{
                data: salaryDistribution.data,
                backgroundColor: colors.gradients.info,
                borderColor: colors.info[0],
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Count' } },
                x: { title: { display: true, text: 'Salary Range' } }
            }
        }
    });

    // 7. Risk Score Histogram
    new Chart(document.getElementById('riskHistogram'), {
        type: 'bar',
        data: {
            labels: riskScoreDistribution.labels,
            datasets: [{
                data: riskScoreDistribution.data,
                backgroundColor: riskScoreDistribution.data.map((val, idx) => {
                    if (idx < 5) return colors.gradients.success;
                    if (idx < 8) return colors.gradients.warning;
                    return colors.gradients.danger;
                }),
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Count' } },
                x: { title: { display: true, text: 'Risk Score Range' } }
            }
        }
    });

    // 8. Feature Importance
    new Chart(document.getElementById('featureImportanceChart'), {
        type: 'bar',
        data: {
            labels: featureImportance.labels,
            datasets: [{
                data: featureImportance.importance_scores,
                backgroundColor: colors.gradients.primary,
                borderColor: colors.primary[0],
                borderWidth: 2,
                borderRadius: 4
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: context => `Importance: ${(context.parsed.x * 100).toFixed(1)}%`
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    max: 0.5,
                    title: { display: true, text: 'Importance Score' },
                    ticks: { callback: value => (value * 100).toFixed(0) + '%' }
                }
            }
        }
    });

    // Counter Animation Function
    function animateCounters() {
        const counters = document.querySelectorAll('.counter');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const counter = entry.target;
                    const target = parseInt(counter.getAttribute('data-target'));
                    const duration = 2000;
                    const increment = target / (duration / 16);
                    let current = 0;
                    
                    const updateCounter = () => {
                        current += increment;
                        if (current < target) {
                            counter.textContent = Math.ceil(current);
                            requestAnimationFrame(updateCounter);
                        } else {
                            counter.textContent = target;
                        }
                    };
                    
                    updateCounter();
                    observer.unobserve(counter);
                }
            });
        });
        
        counters.forEach(counter => observer.observe(counter));
    }

    // Initialize animations
    animateCounters();

    // Animate charts on load
    document.querySelectorAll('canvas').forEach((chart, index) => {
        chart.style.opacity = '0';
        setTimeout(() => {
            chart.style.transition = 'opacity 0.5s ease-in-out';
            chart.style.opacity = '1';
        }, index * 100);
    });
});

// Scroll to Charts Function
function scrollToCharts() {
    const chartsSection = document.getElementById('charts-section');
    if (chartsSection) {
        chartsSection.scrollIntoView({ 
            behavior: 'smooth',
            block: 'start' 
        });
    }
}

// Show/Hide scroll button based on page position
window.addEventListener('scroll', function() {
    const scrollBtn = document.querySelector('.scroll-to-charts-btn');
    const chartsSection = document.getElementById('charts-section');
    
    if (scrollBtn && chartsSection) {
        const chartsTop = chartsSection.offsetTop;
        const scrollPosition = window.pageYOffset + window.innerHeight;
        
        // Show button when not at charts section
        if (scrollPosition < chartsTop + 100) {
            scrollBtn.style.opacity = '1';
            scrollBtn.style.pointerEvents = 'auto';
        } else {
            scrollBtn.style.opacity = '0.6';
            scrollBtn.style.pointerEvents = 'auto';
        }
    }
});
</script>

{% endblock %}
